<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Princess Day !</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;900&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1: #06040a;
    --bg2: #241026;
    --accent: #ff6fae;
    --gold: #ffd66b;
    --ivory: #fff8f2;
    --glass: rgba(255,255,255,0.03);
    --card-max: 980px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Montserrat,system-ui,-apple-system; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
  body{
    background:
      radial-gradient(1000px 500px at 12% 14%, rgba(255,110,160,0.06), transparent),
      linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 100%);
    color:var(--ivory);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    -webkit-font-smoothing:antialiased;
  }

  /* main card */
  .card{
    width:min(96%, var(--card-max));
    border-radius:20px;
    padding:34px;
    position:relative;
    overflow:hidden;
    background: linear-gradient(180deg, rgba(255,255,255,0.016), rgba(0,0,0,0.03));
    border:1px solid var(--glass);
    box-shadow: 0 36px 100px rgba(2,1,6,0.78);
    min-height:720px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:18px;
  }

  /* header area */
  .top{
    width:100%;
    max-width:920px;
    display:flex;
    gap:20px;
    align-items:center;
    justify-content:center;
    flex-wrap:wrap;
    text-align:center;
  }

  .crown{
    width:140px;height:100px;border-radius:12px;
    display:inline-grid;place-items:center;
    background: linear-gradient(135deg,var(--gold),var(--accent));
    box-shadow: 0 18px 48px rgba(0,0,0,0.46);
    transform: translateY(-6px);
    transition: transform .5s cubic-bezier(.2,.9,.26,1);
  }
  .crown.revealed{transform: translateY(-10px) scale(1.06);}

  .title{
    font-family:"Playfair Display",serif;
    font-size:44px;
    margin:0;
    letter-spacing:-0.01em;
    color:var(--ivory);
    text-shadow: 0 14px 36px rgba(0,0,0,0.58);
  }
  .sub{
    margin:0;
    font-size:15px;
    color:rgba(255,255,255,0.92);
  }

  /* from row */
  .from{
    display:flex;gap:12px;align-items:center;margin-top:6px;
  }
  .avatar{
    width:72px;height:72px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.04));
    display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.02)
  }
  .your{
    font-family:"Playfair Display",serif;font-weight:700;font-size:18px;color:var(--ivory)
  }

  /* central type area */
  .center{
    width:100%;
    max-width:880px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
  }
  .typewrap{
    width:100%;
    background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));
    padding:18px 20px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.02);
    min-height:130px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:19px;
    max-width:820px;
    line-height:1.45;
    color:rgba(255,255,255,0.98);
    position:relative;
    box-shadow: 0 18px 40px rgba(0,0,0,0.45);
  }
  .type-text{font-weight:500;max-width:760px}
  .cursor{width:3px;height:30px;background:var(--accent);margin-left:12px;border-radius:2px;animation:blink 1s steps(2,end) infinite}
  @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}

  /* small instruction */
  .hint{font-size:13px;color:rgba(255,255,255,0.78);margin-top:6px}

  /* sparkles decorations */
  .decor{position:absolute;inset:0;pointer-events:none;overflow:hidden}
  .sparkle{position:absolute;border-radius:50%;width:8px;height:8px;background:radial-gradient(circle at 30% 30%,#fff,#ffd6e8 40%);opacity:0.9;filter:blur(.25px);animation:rise linear infinite}
  @keyframes rise{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-560px) scale(.5);opacity:0}}

  /* large faint heart */
  .bg-heart{position:absolute;right:-4%;bottom:-6%;width:420px;height:420px;opacity:0.06;transform:rotate(-18deg);filter:blur(6px);pointer-events:none}

  /* mini player card - integrated */
  .player{
    width:100%;
    max-width:920px;
    display:grid;
    grid-template-columns: 220px 1fr 300px;
    gap:16px;
    align-items:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));
    padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02);
    box-shadow: 0 20px 60px rgba(0,0,0,0.45);
  }
  .thumb{width:200px;height:200px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04))}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .info{
    display:flex;flex-direction:column;gap:10px;justify-content:center;padding:6px 4px;
  }
  .track-title{font-family:"Playfair Display",serif;font-size:20px;margin:0;color:var(--accent)}
  .track-artist{font-size:13px;margin:0;color:rgba(255,255,255,0.82)}
  .controls{display:flex;gap:12px;align-items:center;margin-top:8px}
  .btn{background:linear-gradient(90deg,var(--accent),#ff5fa2);border:none;color:#111;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 10px 26px rgba(255,90,150,0.10)}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:rgba(255,255,255,0.9);padding:8px 12px;border-radius:10px;cursor:pointer}
  .small{padding:8px 10px;font-size:14px}

  .progress-wrap{display:flex;gap:12px;align-items:center;margin-top:8px}
  .time{font-size:12px;color:rgba(255,255,255,0.82);min-width:36px;text-align:center}
  .progress{flex:1;height:8px;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden;position:relative;cursor:pointer}
  .progress > i{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--accent),#ffb6e3);border-radius:8px}
  .thumb-dot{position:absolute;right:0;top:50%;transform:translate(50%,-50%);width:14px;height:14px;border-radius:50%;background:var(--accent);box-shadow:0 6px 20px rgba(255,122,166,0.18)}
  .playlist{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow:auto;padding-right:6px}
  .track{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;cursor:pointer;border:1px solid transparent}
  .track:hover{background:rgba(255,255,255,0.02)}
  .track.active{background:linear-gradient(90deg, rgba(255,122,166,0.07), rgba(255,182,193,0.03));border:1px solid rgba(255,122,166,0.08)}
  .track-thumb{width:56px;height:56px;border-radius:8px;overflow:hidden;flex:0 0 56px}
  .track-thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .track-meta{display:flex;flex-direction:column}
  .track-title-mini{font-size:14px;margin:0;color:var(--ivory)}
  .track-artist-mini{font-size:12px;color:rgba(255,255,255,0.7)}

  .vol-wrap{display:flex;align-items:center;gap:8px;margin-top:6px;justify-content:flex-end}
  input[type="range"]{appearance:none;height:6px;background:rgba(255,255,255,0.04);border-radius:6px;cursor:pointer}
  input[type="range"]::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:var(--accent);box-shadow:0 6px 20px rgba(255,122,166,0.18)}

  /* bottom central controls - reveal and copy link */
  .controls-bottom{
    position:fixed;left:50%;transform:translateX(-50%);bottom:18px;display:flex;gap:12px;align-items:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.032));padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 12px 30px rgba(0,0,0,0.45);backdrop-filter: blur(6px);
  }
  .btn-small{padding:8px 10px;border-radius:10px;border:none;cursor:pointer;font-weight:700}

  @media (max-width:1024px){
    .player{grid-template-columns: 180px 1fr;grid-template-rows:auto auto;gap:12px}
    .playlist{grid-column:1/3;display:flex;flex-direction:row;gap:8px;overflow:auto;padding:6px}
    .track{min-width:180px;flex:0 0 auto}
    .thumb{width:140px;height:140px}
    .card{min-height:760px}
  }
  @media (max-width:640px){
    .title{font-size:32px}
    .typewrap{font-size:16px;padding:12px}
    .crown{width:110px;height:80px}
    .controls-bottom{bottom:12px;padding:8px 10px}
  }
</style>
</head>
<body>

<!-- track files go in folder tracks/ as instructed -->
<!-- playlist config uses:
     tracks/visiri.mp3
     tracks/paayum_theeye.mp3
     tracks/aaruyire.mp3
     tracks/mun_andhi.mp3
     tracks/mazhai_vara_pogudhe.mp3
     thumbnails: tracks/thumb1.jpg ... thumb5.jpg
-->

<!-- primary audio element for card ambient + initial unlock is handled by player as well -->
<audio id="cardAmbient" src="tracks/visiri.mp3" preload="auto"></audio>

<div class="card" role="main" aria-label="Princess Day card">
  <div class="top" id="top">
    <div class="crown" id="crownEl" aria-hidden="true">
      <!-- crisp crown SVG -->
      <svg viewBox="0 0 64 44" width="92" height="66" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g fill="none" fill-rule="evenodd">
          <path d="M3 40h58v2H3z" fill="#2b1a18" opacity="0.12"/>
          <path d="M5 36l10-20 8 16 10-24 8 20 8-12 7 20v0H5z" fill="url(#grad)"/>
          <path d="M5 36l10-20 8 16 10-24 8 20 8-12 7 20" stroke="#40221a" stroke-width="0.9" opacity="0.12"/>
          <defs>
            <linearGradient id="grad" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#ffd66b"/>
              <stop offset="1" stop-color="#ff7ab6"/>
            </linearGradient>
          </defs>
        </g>
      </svg>
    </div>

    <div>
      <h1 class="title">Happy Princess Day !</h1>
      <p class="sub">For <strong id="herName" style="color:var(--accent)">RðŸ¥°</strong> - my quiet favorite</p>
      <div class="from" aria-hidden="true">
        <div class="avatar" aria-hidden="true">
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none"><path d="M12 21s-7.5-4.7-9.2-7.1C.5 10.8 3 .5 7 3.3 9.1 1.6 12 5 12 5s2.9-3.4 5-1.7c4-2.8 6.5 7.5 4.2 10.6C19.5 16.3 12 21 12 21z" fill="#ffb6d2"/></svg>
        </div>
        <div class="your" id="yourName">with loads of love, V</div>
      </div>
    </div>
  </div>

  <div class="center">
    <div class="typewrap" aria-live="polite">
      <div class="type-text" id="typeText"></div>
      <div class="cursor" aria-hidden="true"></div>
    </div>

    <div class="hint">Tap anywhere to start music and reveal the crown</div>

    <!-- integrated player -->
    <div class="player" role="application" aria-label="music player">
      <div class="thumb" id="mainThumb">
        <img src="tracks/thumb1.jpg" id="mainThumbImg" alt="track thumbnail" />
      </div>

      <div class="info">
        <div>
          <div class="track-title" id="trackTitle">Visiri</div>
          <div class="track-artist" id="trackArtist">Unknown</div>
        </div>

        <div class="controls" aria-hidden="true">
          <button class="btn-ghost small" id="prevBtn">Prev</button>
          <button class="btn" id="playBtn">Play</button>
          <button class="btn-ghost small" id="nextBtn">Next</button>
          <div style="flex:1"></div>
          <button class="btn-ghost small" id="repeatBtn">Repeat Off</button>
        </div>

        <div class="progress-wrap" aria-hidden="true">
          <div class="time" id="curTime">0:00</div>
          <div class="progress" id="progressBar" title="Seek">
            <i></i>
            <div class="thumb-dot" id="thumbDot" style="left:0%"></div>
          </div>
          <div class="time" id="durTime">0:00</div>
        </div>

        <div class="vol-wrap">
          <label style="font-size:13px;color:rgba(255,255,255,0.82)">Vol</label>
          <input type="range" id="volume" min="0" max="1" step="0.01" value="0.9" />
        </div>
      </div>

      <div class="playlist" id="playlist" aria-hidden="true">
        <!-- tracks injected here -->
      </div>
    </div>
  </div>

  <div class="decor" id="decorLayer" aria-hidden="true"></div>
  <svg class="bg-heart" viewBox="0 0 32 32" aria-hidden="true"><path d="M16 29s-9.5-6.3-12-10.2C1 14 3.3 5 10 8c2-3 6-3 6-3s4 0 6 3c6.7-3 9 6 6 10.8C25.5 22.7 16 29 16 29z" fill="#ff6faea6"/></svg>
</div>

<!-- bottom controls -->
<div class="controls-bottom" role="toolbar" aria-label="controls">
  <button class="btn-small btn" id="revealBtn" title="Reveal crown">Reveal Crown</button>
  <button class="btn-small btn-ghost" id="musicToggle" title="Music toggle">Music: Off</button>
  <a id="copyLink" class="btn-small btn-ghost" href="#">Copy Link</a>
</div>

<!-- core audio for player -->
<audio id="audio" preload="auto"></audio>

<script>
/* ---------- message lines - natural, not corny ---------- */
const petNames = ["bubba","baby","chello","sweetheart","darling","cutu","chuntu","kuchupuchu"];
const baseLines = [
  name => `${capitalize(name)}, your laugh resets my day.`,
  name => `${capitalize(name)}, when you rest your head everything calms.`,
  name => `${capitalize(name)}, your hand in mine makes the room smaller in the best way.`,
  name => `${capitalize(name)}, small things feel important when you are near.`,
  name => `${capitalize(name)}, stay close and let the night belong to us.`,
  name => `${capitalize(name)}, I keep finding reasons to smile because of you.`,
  name => `${capitalize(name)}, you make quiet moments feel like home.`,
  name => `${capitalize(name)}, the light around you is a private thing I love.`
];
let messageLines = petNames.map((n,i) => baseLines[i % baseLines.length](n));
messageLines = messageLines.concat([
  "I want to memorize every curve of your evening voice.",
  "Keep this for nights you need a little crown of light."
]);

/* ---------- playlist config - your provided names and thumbs ---------- */
const playlist = [
  { title: "Visiri", file: "tracks/visiri.mp3", thumb: "tracks/thumb1.jpg", artist: "" },
  { title: "Paayum Theeye", file: "tracks/paayum_theeye.mp3", thumb: "tracks/thumb2.jpg", artist: "" },
  { title: "Aaruyire", file: "tracks/aaruyire.mp3", thumb: "tracks/thumb3.jpg", artist: "" },
  { title: "Mun Andhi", file: "tracks/mun_andhi.mp3", thumb: "tracks/thumb4.jpg", artist: "" },
  { title: "Mazhai Vara Pogudhe", file: "tracks/mazhai_vara_pogudhe.mp3", thumb: "tracks/thumb5.jpg", artist: "" }
];

/* ---------- DOM refs ---------- */
const typeText = document.getElementById('typeText');
const crownEl = document.getElementById('crownEl');
const decor = document.getElementById('decorLayer');
const revealBtn = document.getElementById('revealBtn');
const musicToggle = document.getElementById('musicToggle');
const copyLink = document.getElementById('copyLink');
const audio = document.getElementById('audio');

const playlistEl = document.getElementById('playlist');
const mainThumbImg = document.getElementById('mainThumbImg');
const trackTitle = document.getElementById('trackTitle');
const trackArtist = document.getElementById('trackArtist');
const playBtn = document.getElementById('playBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const progressBar = document.getElementById('progressBar');
const progressFill = progressBar.querySelector('i');
const thumbDot = document.getElementById('thumbDot');
const curTime = document.getElementById('curTime');
const durTime = document.getElementById('durTime');
const volume = document.getElementById('volume');
const repeatBtn = document.getElementById('repeatBtn');

/* ---------- state ---------- */
let li = 0, ci = 0, deleting = false;
let currentTrack = 0;
let isPlaying = false;
let isRepeat = false;
let musicOn = false;
let fadeHandle = null;

/* ---------- typewriter loop ---------- */
function typeLoop() {
  const line = messageLines[li];
  if (!deleting) {
    if (ci <= line.length) {
      typeText.textContent = line.slice(0, ci);
      ci++;
      setTimeout(typeLoop, 36 + Math.random()*30);
    } else {
      deleting = true;
      setTimeout(typeLoop, 1100 + Math.random()*600);
    }
  } else {
    if (ci >= 0) {
      typeText.textContent = line.slice(0, ci);
      ci--;
      setTimeout(typeLoop, 18 + Math.random()*18);
    } else {
      deleting = false;
      li = (li + 1) % messageLines.length;
      setTimeout(typeLoop, 300);
    }
  }
}
typeLoop();

/* ---------- decorative sparkles ---------- */
function spawnDecor(count=10) {
  const frag = document.createDocumentFragment();
  for (let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'sparkle';
    const left = Math.random()*110 - 5;
    el.style.left = left + '%';
    el.style.top = (60 + Math.random()*30) + '%';
    const size = (6 + Math.random()*10);
    el.style.width = size + 'px';
    el.style.height = size + 'px';
    el.style.opacity = 0.8 - Math.random()*0.5;
    el.style.animationDuration = (3 + Math.random()*4) + 's';
    el.style.animationDelay = Math.random()*1.5 + 's';
    frag.appendChild(el);
  }
  decor.appendChild(frag);
  setTimeout(()=> {
    while (decor.children.length > 80) decor.removeChild(decor.firstChild);
  }, 8000);
}
spawnDecor();
setInterval(()=> spawnDecor(6), 2600);

/* ---------- player UI render ---------- */
function renderPlaylist(){
  playlistEl.innerHTML = '';
  playlist.forEach((t, idx) => {
    const tr = document.createElement('div');
    tr.className = 'track';
    tr.dataset.index = idx;
    tr.tabIndex = 0;
    tr.innerHTML = `
      <div class="track-thumb"><img src="${t.thumb}" alt="${t.title} thumb" /></div>
      <div class="track-meta">
        <div class="track-title-mini">${t.title}</div>
        <div class="track-artist-mini">${t.artist || ''}</div>
      </div>
    `;
    tr.addEventListener('click', ()=> { loadTrack(idx); playAudio(); });
    tr.addEventListener('keydown', (e)=> { if (e.key === 'Enter') { loadTrack(idx); playAudio(); }});
    playlistEl.appendChild(tr);
  });
  updateActive();
}

/* ---------- load track ---------- */
function loadTrack(index){
  if (index < 0) index = playlist.length - 1;
  if (index >= playlist.length) index = 0;
  currentTrack = index;
  const t = playlist[currentTrack];
  audio.src = t.file;
  mainThumbImg.src = t.thumb;
  trackTitle.textContent = t.title;
  trackArtist.textContent = t.artist || '';
  updateActive();
  progressFill.style.width = '0%';
  thumbDot.style.left = '0%';
  curTime.textContent = '0:00';
  durTime.textContent = '0:00';
}

/* ---------- update active track styling ---------- */
function updateActive(){
  [...playlistEl.children].forEach(el => el.classList.remove('active'));
  const active = playlistEl.querySelector(`[data-index="${currentTrack}"]`);
  if (active) active.classList.add('active');
}

/* ---------- playback helpers ---------- */
function playAudio(){
  audio.play().then(()=> {
    isPlaying = true;
    playBtn.textContent = 'Pause';
    musicToggle.textContent = 'Music: On';
    musicOn = true;
  }).catch(()=> {
    isPlaying = false;
    playBtn.textContent = 'Play';
  });
}
function pauseAudio(){
  audio.pause();
  isPlaying = false;
  playBtn.textContent = 'Play';
}

/* ---------- format time ---------- */
function fmt(t){
  if (!t || isNaN(t)) return '0:00';
  const m = Math.floor(t / 60);
  const s = Math.floor(t % 60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

/* ---------- audio events ---------- */
audio.addEventListener('timeupdate', ()=>{
  const p = (audio.currentTime / audio.duration) || 0;
  const percent = Math.max(0, Math.min(1, p)) * 100;
  progressFill.style.width = percent + '%';
  thumbDot.style.left = percent + '%';
  curTime.textContent = fmt(audio.currentTime);
});
audio.addEventListener('loadedmetadata', ()=> { durTime.textContent = fmt(audio.duration); });
audio.addEventListener('ended', ()=> {
  if (isRepeat) { audio.currentTime = 0; playAudio(); }
  else { nextTrack(); }
});

/* ---------- seek and dragging ---------- */
progressBar.addEventListener('click', (e)=>{
  const rect = progressBar.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const p = x / rect.width;
  audio.currentTime = p * audio.duration;
});
let seeking = false;
function seekAtClientX(clientX){
  const rect = progressBar.getBoundingClientRect();
  let x = clientX - rect.left;
  x = Math.max(0, Math.min(rect.width, x));
  const p = x / rect.width;
  audio.currentTime = p * audio.duration;
}
thumbDot.addEventListener('pointerdown', (e)=>{
  seeking = true;
  e.preventDefault();
  thumbDot.setPointerCapture(e.pointerId);
});
window.addEventListener('pointermove', (e)=>{ if (!seeking) return; seekAtClientX(e.clientX); });
window.addEventListener('pointerup', (e)=>{ if (seeking) { seeking = false; try{ thumbDot.releasePointerCapture(e.pointerId) }catch{} } });

/* ---------- controls actions ---------- */
playBtn.addEventListener('click', ()=> { if (isPlaying) pauseAudio(); else playAudio(); });
prevBtn.addEventListener('click', ()=> { prevTrack(); });
nextBtn.addEventListener('click', ()=> { nextTrack(); });
function prevTrack(){ loadTrack((currentTrack - 1 + playlist.length) % playlist.length); playAudio(); }
function nextTrack(){ loadTrack((currentTrack + 1) % playlist.length); playAudio(); }

/* ---------- volume ---------- */
volume.addEventListener('input', (e)=> { audio.volume = parseFloat(e.target.value); });

/* ---------- repeat ---------- */
repeatBtn.addEventListener('click', ()=> {
  isRepeat = !isRepeat;
  repeatBtn.textContent = isRepeat ? 'Repeat On' : 'Repeat Off';
});

/* ---------- reveal crown ---------- */
revealBtn.addEventListener('click', ()=> {
  const revealed = crownEl.classList.toggle('revealed');
  burstReveal();
});
function burstReveal(){
  const count = 10;
  for (let i=0;i<count;i++){
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.style.left = (40 + Math.random()*20) + '%';
    s.style.top = (6 + Math.random()*24) + '%';
    const size = (7 + Math.random()*10);
    s.style.width = size + 'px'; s.style.height = size + 'px';
    s.style.animationDuration = (1.2 + Math.random()*1.6) + 's';
    decor.appendChild(s);
    setTimeout(()=> s.remove(), 2400);
  }
}

/* ---------- music toggle with fade in/out and tap-to-unlock ---------- */
function fadeIn() {
  if (fadeHandle) clearInterval(fadeHandle);
  try { audio.volume = 0; audio.loop = false; audio.play().catch(()=>{}); } catch(e){}
  fadeHandle = setInterval(() => {
    audio.volume = Math.min(1, +(audio.volume + 0.05).toFixed(2));
    if (audio.volume >= 1) clearInterval(fadeHandle);
  }, 120);
}
function fadeOut() {
  if (fadeHandle) clearInterval(fadeHandle);
  fadeHandle = setInterval(() => {
    audio.volume = Math.max(0, +(audio.volume - 0.05).toFixed(2));
    if (audio.volume <= 0) { audio.pause(); clearInterval(fadeHandle); }
  }, 120);
}
function unlockAudioOnFirstGesture(){
  if (!musicOn) {
    // start with currentTrack or first track
    loadTrack(currentTrack);
    fadeIn();
    isPlaying = true;
    playBtn.textContent = 'Pause';
    musicOn = true;
    musicToggle.textContent = 'Music: On';
  }
  window.removeEventListener('pointerdown', unlockAudioOnFirstGesture);
}
window.addEventListener('pointerdown', unlockAudioOnFirstGesture, {passive:true});
musicToggle.addEventListener('click', ()=> {
  if (!musicOn) { fadeIn(); musicToggle.textContent = 'Music: On'; isPlaying = true; playBtn.textContent='Pause'; }
  else { fadeOut(); musicToggle.textContent = 'Music: Off'; isPlaying = false; playBtn.textContent='Play'; }
  musicOn = !musicOn;
});

/* ---------- copy link ---------- */
copyLink.addEventListener('click', (e)=> {
  e.preventDefault();
  const url = location.href;
  if (navigator.clipboard) {
    navigator.clipboard.writeText(url).then(()=> {
      copyLink.textContent = 'Link copied';
      setTimeout(()=> copyLink.textContent = 'Copy Link', 2000);
    }).catch(()=> alert('Copy the page URL from your browser address bar.'));
  } else {
    alert('Copy the page URL from your browser address bar.');
  }
});

/* ---------- accessibility - reduced motion ---------- */
if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
  document.querySelectorAll('.sparkle').forEach(n => n.style.animationDuration = '0.001s');
  const c = document.querySelector('.cursor');
  if (c) c.style.animation = 'none';
}

/* ---------- utilities ---------- */
function capitalize(s){ if(!s) return s; return s.charAt(0).toUpperCase() + s.slice(1); }

/* ---------- initial setup ---------- */
renderPlaylist();
loadTrack(0);
audio.volume = parseFloat(document.getElementById('volume').value || 0.9);

/* seed small sparkles immediately */
window.addEventListener('load', ()=> {
  for (let i=0;i<8;i++){
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.style.left = (6 + Math.random()*88) + '%';
    s.style.top = (30 + Math.random()*40) + '%';
    const size = (5 + Math.random()*8);
    s.style.width = size + 'px'; s.style.height = size + 'px';
    s.style.animationDuration = (2 + Math.random()*3) + 's';
    decor.appendChild(s);
  }
});
</script>
</body>
</html>
